<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alibabasmt.database.customsmt.mapper.OrderTableMapper">
  <resultMap id="BaseResultMap" type="com.alibabasmt.domains.querypojos.smtorder.OrderTableQuery">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
      <id column="id" jdbcType="BIGINT" property="id" />
      <result column="orderId" jdbcType="VARCHAR" property="orderid" />
      <result column="orderStatus" jdbcType="VARCHAR" property="orderstatus" />
      <result column="bizType" jdbcType="VARCHAR" property="biztype" />
      <result column="memo" jdbcType="VARCHAR" property="memo" />
      <result column="gmtCreate" jdbcType="VARCHAR" property="gmtcreate" />
      <result column="gmtModified" jdbcType="VARCHAR" property="gmtmodified" />
      <result column="create_user" jdbcType="BIGINT" property="createUser" />
      <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
      <result column="uuid" jdbcType="VARCHAR" property="uuid" />
      <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
      <result column="pictureUrl" jdbcType="VARCHAR" property="pictureUrl" />
      <result column="skuCode" jdbcType="VARCHAR" property="skuCode" />
      <result column="price" jdbcType="VARCHAR" property="price" />
      <result column="cur" jdbcType="VARCHAR" property="cur" />
      <result column="status" jdbcType="VARCHAR" property="status" />
      <result column="comment" jdbcType="VARCHAR" property="comment" />
      <!--//-->
      <result column="productName" jdbcType="VARCHAR" property="productName" />
      <result column="productId" jdbcType="VARCHAR" property="productId" />
      <result column="firstName" jdbcType="VARCHAR" property="firstName" />
      <result column="lastName" jdbcType="VARCHAR" property="lastName" />
      <result column="buyerEmail" jdbcType="VARCHAR" property="buyerEmail" />
      <result column="logisticsNo" jdbcType="VARCHAR" property="logisticsNo" />
      <result column="logisticsServiceName" jdbcType="VARCHAR" property="logisticsServiceName" />
      <result column="sellerOperatorLoginId" jdbcType="VARCHAR" property="sellerOperatorLoginId" />
      <result column="productSnapUrl" jdbcType="VARCHAR" property="productSnapUrl" />

  </resultMap>

    <select id="selectSmtOrderTableList" resultMap="BaseResultMap" parameterType="map">
        select orderTable.id,orderTable.gmtModified,orderTable.gmtCreate,orderTable.orderId,orderTable.orderStatus,orderTable.bizType,orderTable.comment,childOrder.productImgUrl pictureUrl,childOrder.skuCode skuCode,childOrder.productUnitPrice price,childOrder.productUnitPriceCur cur,dic.value status,
        childOrder.productName productName,childOrder.productId productId,buyerInfo.firstName firstName,buyerInfo.lastName lastName,buyerInfo.email buyerEmail,
        orderDetails.logisticsNo logisticsNo, orderDetails.logisticsServiceName logisticsServiceName,orderDetails.sellerOperatorLoginId sellerOperatorLoginId,childOrder.productSnapUrl productSnapUrl
        from smt_order_table orderTable
        left join smt_order_children_order childOrder on childOrder.parentOrderId=orderTable.orderId
        left join smt_data_dictionary dic on dic.name=orderTable.orderStatus and dic.type="orderStatus"
        LEFT JOIN smt_order_details orderDetails ON orderDetails.orderId=orderTable.orderId
        LEFT JOIN smt_order_buyer_info buyerInfo ON buyerInfo.loginId=orderDetails.buyerloginid
        left join smt_order_receipt_address receiptaddress on receiptaddress.orderId=orderTable.orderId
        where 1=1
        <if test="id!=null">
            and orderTable.id = #{id}
        </if>
        <if test="folderId!=null">
            and orderTable.folder=#{folderId}
        </if>
        <if test="status!=null">
            <if test="status=='unpaid'">
                and orderTable.orderStatus="PLACE_ORDER_SUCCESS"
            </if>
            <if test="status=='uncleared'">
                and orderTable.orderStatus="SELLER_PART_SEND_GOODS"
            </if>
            <if test="status=='paid'">
                and (orderTable.orderStatus="WAIT_SELLER_SEND_GOODS" or orderTable.orderStatus="WAIT_BUYER_ACCEPT_GOODS" or orderTable.orderStatus="WAIT_SELLER_EXAMINE_MONEY")
            </if>
            <if test="status=='cancel'">
                and orderTable.orderStatus="IN_CANCEL"
            </if>
        </if>
        <if test="statusQ!=null">
            <if test="statusQ==1">
                and (orderTable.orderStatus="WAIT_SELLER_SEND_GOODS" or orderTable.orderStatus="WAIT_BUYER_ACCEPT_GOODS" or orderTable.orderStatus="WAIT_SELLER_EXAMINE_MONEY")
            </if>
            <if test="statusQ==2">
                and (orderTable.orderStatus="FUND_PROCESSING" or orderTable.orderStatus="WAIT_BUYER_ACCEPT_GOODS" )
            </if>
            <if test="statusQ==3">
                and (orderTable.orderStatus="FUND_PROCESSING" or orderTable.orderStatus="FINISH" )
            </if>
            <if test="statusQ==4">
                and orderTable.orderStatus="WAIT_BUYER_ACCEPT_GOODS"
            </if>
        </if>
        <if test="countryQ!=null">
            and receiptaddress.country=#{countryQ}
        </if>
        <if test="starttime!=null">
            and orderTable.gmtCreate >= #{starttime}
        </if>
        <if test="endtime!=null">
            and orderTable.gmtCreate &lt; #{endtime}
        </if>
        <if test="itemType!=null">
            <if test="content!=null">
                <if test="itemType=='buyerLoginId'">
                    and orderDetails.buyerloginid like "%"#{content}"%"
                </if>
                <if test="itemType=='productId'">
                    and childOrder.productId like "%"#{content}"%"
                </if>
                <if test="itemType=='sku'">
                    and childOrder.skuCode like "%"#{content}"%"
                </if>
                <if test="itemType=='title'">
                    and childOrder.productName like "%"#{content}"%"
                </if>
                <if test="itemType=='trackNum'">
                    and orderDetails.logisticsNo like "%"#{content}"%"
                </if>
                <if test="itemType=='person'">
                        and orderDetails.buyerSignerFullname like "%"#{content}"%"
                </if>
                <if test="itemType=='buyerEmail'">
                    and buyerInfo.email like "%"#{content}"%"
                </if>
                <if test="itemType=='comment'">
                    and orderTable.memo like "%"#{content}"%"
                </if>
                <if test="itemType=='orderId'">
                    and orderTable.orderId like "%"#{content}"%"
                </if>
            </if>
        </if>
        group by orderTable.orderId
        order by orderTable.gmtCreate desc
    </select>
</mapper>