<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.base.database.customtrading.mapper.TemBinListingDataReportMapper">
    <resultMap id="BaseResultMap" type="com.base.domains.querypojos.ListingDataQuery">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="item_id" jdbcType="VARCHAR" property="itemId" />
        <result column="pic_url" jdbcType="VARCHAR" property="picUrl" />
        <result column="sku" jdbcType="VARCHAR" property="sku" />
        <result column="ebay_account" jdbcType="VARCHAR" property="ebayAccount" />
        <result column="site" jdbcType="VARCHAR" property="site" />
        <result column="listing_type" jdbcType="VARCHAR" property="listingType" />
        <result column="price" jdbcType="BIGINT" property="price" />
        <result column="shipping_price" jdbcType="BIGINT" property="shippingPrice" />
        <result column="Quantity" jdbcType="BIGINT" property="quantity" />
        <result column="QuantitySold" jdbcType="BIGINT" property="quantitysold" />
        <result column="ListingDuration" jdbcType="VARCHAR" property="listingduration" />
        <result column="StartTime" jdbcType="TIMESTAMP" property="starttime" />
        <result column="EndTime" jdbcType="TIMESTAMP" property="endtime" />
        <result column="do_rate" jdbcType="BIGINT" property="doRate" />
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
        <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
        <result column="title" jdbcType="VARCHAR" property="title" />
        <result column="create_user" jdbcType="BIGINT" property="createUser" />
        <result column="folder_id" jdbcType="VARCHAR" property="folderId" />
        <result column="remark" jdbcType="VARCHAR" property="remark" />
        <result column="currencyId" property="currencyId" jdbcType="VARCHAR" />
        <result column="siteName" property="siteName" jdbcType="VARCHAR" />
        <result column="docTitle" property="docTitle" jdbcType="VARCHAR" />
        <result column="docId" property="docId" jdbcType="VARCHAR" />
    </resultMap>

    <!--本系统当天刊登数量，总刊登数量-->
    <select id="selectTemBinListingReportList" resultMap="BaseResultMap" parameterType="map">

        <if test="flag==1">
            select ldata.id from trading_listing_data ldata,trading_tembin_listing_log suc where ldata.item_id=suc.item_id
            and ldata.ebay_account in
            (select ee.ebay_account from usercontroller_user_ebay ue,usercontroller_ebay_account ee where ue.ebay_id=ee.id and ee.ebay_status='1' and ue.user_id=#{userid})
            and ldata.is_flag='0'
            and DATE_FORMAT(suc.create_date, '%Y-%m-%d') = #{datestr}
        </if>
        <if test="flag==0">
            select lo.id from trading_tembin_listing_log lo,trading_item item where lo.doc_id=item.id
            and item.ebay_account in (select ee.id from usercontroller_user_ebay ue,usercontroller_ebay_account ee where ue.ebay_id=ee.id and ee.ebay_status='1' and ue.user_id=#{userid});
        </if>
    </select>

    <!--所有在线商品数量-->
    <select id="selectAllListingDataReportList" resultMap="BaseResultMap" parameterType="map">
        select ldata.id from trading_listing_data ldata where ldata.is_flag='0' and ldata.ebay_account in
        (select ee.ebay_account from usercontroller_user_ebay ue,usercontroller_ebay_account ee where ue.ebay_id=ee.id and ee.ebay_status='1' and ue.user_id=#{userid})
    </select>

    <!--查询所有主账户-->
    <select id="queryAllUser" parameterType="map" resultType="com.base.domains.userinfo.UsercontrollerUserExtend">

    select u.user_id userId  ,
        u.user_name userName,
        u.user_login_id userLoginId,
        u.user_org_id userOrgId,
        u.user_parent_id userParentId,
        u.`status` `status`,
        u.user_email userEmail,
        u.tel_phone telPhone,
        u.address address,
        u.create_time createTime,
        log.createDate newLoinTime,
        org.org_name orgName
        from usercontroller_user u
        LEFT JOIN
			(select id,operUser,createDate
			from (select id,operUser,createDate from system_log l where l.eventName='user_login_log' order by l.createDate desc) t
			group by operUser) log on u.user_login_id=log.operUser
        LEFT JOIN usercontroller_org org on org.org_id=u.user_org_id
        where  u.user_parent_id is NULL
        <if test="active==null">
            AND u.status = '1'
        </if>
        <if test="active!=null">
            AND u.status = #{active}
        </if>
        ORDER BY u.create_time DESC

    </select>

    <!--查询所有账户-->
    <select id="queryAllUserS" parameterType="map" resultType="com.base.domains.userinfo.UsercontrollerUserExtend">

        select u.user_id userId  ,
        u.user_name userName,
        u.user_login_id userLoginId,
        u.user_org_id userOrgId,
        u.user_parent_id userParentId,
        u.`status` `status`,
        u.user_email userEmail,
        u.tel_phone telPhone,
        u.address address,
        u.create_time createTime,
        log.createDate newLoinTime
        from usercontroller_user u
        LEFT JOIN
        (select id,operUser,createDate
        from (select id,operUser,createDate from system_log l where l.eventName='user_login_log' order by l.createDate desc) t
        group by operUser) log on u.user_login_id=log.operUser

        where  u.user_parent_id =#{parentID}
        <if test="active==null">
            AND u.status = '1'
        </if>
        ORDER BY u.create_time DESC

    </select>

    <select  id="querySkuByUser" parameterType="map" resultType="com.base.database.trading.model.TradingItem">
        select DISTINCT sku from trading_item where ebay_account in
        (select ee.id from usercontroller_user_ebay ue,usercontroller_ebay_account ee where ue.ebay_id=ee.id and ee.ebay_status='1' and ue.user_id=#{userid})
        and check_flag='0'
    </select>

</mapper>